{{#section 'head'}}
   <title>{{text}}</title>
   <meta charset="utf-8">
   <style type="text/css">
   	.form{
   		text-align: left;
   		padding-top: 1.2em;
   		border-radius: 10px;
   	}
		.alert{
			display: none;
		}
   </style>
{{/section}}

<div id="form-add" class="form row bg-success {{#if form-add}}{{else}}hidden{{/if}}
">
	<div class="col-sm-6 col-sm-offset-3 col-xs-12">
		<form class="form-horizontal">
		  <div class="form-group">
		    <label for="inputEmail3" class="col-sm-2 control-label">Логин</label>
		    <div class="col-sm-10">
		      <input type="email" class="form-control" id="login" name="login" placeholder="Логин">
		    </div>
		  </div>
		  <div class="form-group">
		    <label for="inputPassword3" class="col-sm-2 control-label">Пароль</label>
		    <div class="col-sm-10">
		      <input type="password" class="form-control" id="pass" name="pass" placeholder="Пароль">
		    </div>
		  </div>
		  <div class="form-group">
		    <div class="col-sm-offset-2 col-sm-10">
		      <button id="form-add-button" type="button" class="btn btn-default">Добавить пользователя</button>
		    </div>
		  </div>
		</form>
		<div id="alert-add" class=" alert"></div>
	</div>
</div>

<script type="text/javascript">
$('#form-add-button').bind('click', function(){
	if ($('#login').val()!=="" && $('#pass').val()!==""){
		$.ajax({
		  type: "POST",
		  url: "/users",
		  data: $("#form-add form").serializeArray(),
		  beforeSend: function () {
		  	$('#form-add-button').prop('disabled',true);
		  },
		  success: function(msg){
		    $("#alert-add")
		    	.removeClass("alert-danger")
		    	.addClass("alert-info")
		    	.text(msg)
		    	.slideDown(300);
		  }
		});
	} else $("#alert-add").addClass("alert-danger").text("Не все поля заполнены!").slideDown(300)
});
</script>

<div id="form-remove" class="form row bg-danger {{#if form-remove}}{{else}}hidden{{/if}}
">
	<div class="col-sm-6 col-sm-offset-3 col-xs-12">
		<form class="form-horizontal">
		  <div class="form-group">
		    <label for="inputEmail3" class="col-sm-2 control-label">Логин</label>
		    <div class="col-sm-10">
					<select class="form-control" id="remove-list">
					<option val="null" disabled selected>Выберите пользователя...</option>
					{{#each users}}
						<option val="{{login}}">{{login}}</option>
					{{/each}}
					</select>		  `    
		    </div>
		  </div>
		  <div class="form-group">
		    <div class="col-sm-offset-2 col-sm-10">
		      <button id="form-remove-button" type="button" class="btn btn-default">Удалить пользователя</button>
		    </div>
		  </div>
		</form>
		<div id="alert-remove" class="alert"></div>
	</div>
</div>

<script type="text/javascript">
$('#form-remove-button').bind('click', function(){
	var login = $("#remove-list :selected").val();
	if (login !=='null'){
		$.ajax({
		  type: "DELETE",
		  url: "/users/"+login,
		  data: "",
		  beforeSend: function () {
		  	$('#form-remove-button').prop('disabled',true);
		  	$("#remove-list").prop('disabled',true);
		  },
		  success: function(msg){
		    $("#alert-remove")
		    	.removeClass("alert-danger")
		    	.addClass("alert-info")
		    	.text(msg)
		    	.slideDown(300);
		  }
		});
	} else $("#alert-remove").addClass("alert-danger").text("Не выбран пользователь!").slideDown(300)
});
</script>


<div class="row">
	<h1>Все пользователи</h1>
	<p class="lead">Здесь можно увидеть всех пользоателей из базы данных</p>
	<div class="col-sm-6 col-sm-offset-3 col-xs-12">
		<table class="table table-striped table-hover table-bordered ">
			<tr class="info">
				<td>Логин</td>
				<td>Пароль</td>
				<td>Прочее</td>
			</tr>
		{{#each users}}
			<tr>
				<td>{{login}}</td>
				<td>{{pass}}</td>
				<td><a href="/users/{{login}}">Подробности...</a></td>
			</tr>
		{{/each}}
		</table>
	</div>
</div>